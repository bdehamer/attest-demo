name: "Debug"
description: "Debug action that dumps context and requests an OIDC token"

runs:
  using: "composite"
  steps:
    - uses: hmarr/debug-action@v2

    - name: Request OIDC Token
      shell: bash
      run: |
        # Request token
        curl "${ACTIONS_ID_TOKEN_REQUEST_URL}&audience=nobody" \
          -H "Authorization: bearer ${ACTIONS_ID_TOKEN_REQUEST_TOKEN}" \
          -H "Accept: application/json; api-version=2.0" \
          -H "Content-Type: application/json" \
          --silent | jq -r '.value' > oidc_token
        echo -e "\nOIDC Token (decoded)"

        cat oidc_token | jq -R 'split(".") | .[0],.[1] | @base64d | fromjson'

        rm oidc_token
